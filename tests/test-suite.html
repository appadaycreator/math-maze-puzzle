<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Maze Puzzle - ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ</title>
    <link rel="shortcut icon" href="../assets/icons/favicon.svg">
    
    <!-- ãƒ†ã‚¹ãƒˆç”¨CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .test-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .test-content {
            padding: 30px;
        }
        
        .test-controls {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .test-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-results {
            margin-top: 30px;
        }
        
        .test-group {
            margin-bottom: 30px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .test-group-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e1e5e9;
            font-weight: bold;
            color: #495057;
        }
        
        .test-case {
            padding: 15px 20px;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-case:last-child {
            border-bottom: none;
        }
        
        .test-case.passed {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .test-case.failed {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .test-case.pending {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .test-name {
            font-weight: 500;
        }
        
        .test-status {
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .test-status.passed {
            background: #28a745;
            color: white;
        }
        
        .test-status.failed {
            background: #dc3545;
            color: white;
        }
        
        .test-status.pending {
            background: #ffc107;
            color: #212529;
        }
        
        .test-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            text-align: center;
        }
        
        .test-summary h3 {
            margin-bottom: 15px;
            color: #495057;
        }
        
        .summary-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-passed .stat-number {
            color: #28a745;
        }
        
        .stat-failed .stat-number {
            color: #dc3545;
        }
        
        .stat-pending .stat-number {
            color: #ffc107;
        }
        
        .stat-total .stat-number {
            color: #495057;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .error-details {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #6c757d;
            white-space: pre-wrap;
        }
        
        @media (max-width: 768px) {
            .test-header h1 {
                font-size: 2rem;
            }
            
            .test-controls {
                justify-content: stretch;
            }
            
            .test-btn {
                flex: 1;
            }
            
            .summary-stats {
                gap: 15px;
            }
            
            .test-case {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ§® Math Maze Puzzle</h1>
            <p>ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ - æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ & UI ãƒ†ã‚¹ãƒˆ</p>
        </div>
        
        <div class="test-content">
            <div class="test-controls">
                <button class="test-btn" id="runAllTests">å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <button class="test-btn" id="runUnitTests">ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" id="runUITests">UIãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" id="runGameTests">ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" id="clearResults">çµæœã‚’ã‚¯ãƒªã‚¢</button>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="test-summary" id="testSummary" style="display: none;">
                <h3>ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h3>
                <div class="summary-stats">
                    <div class="stat stat-total">
                        <div class="stat-number" id="totalTests">0</div>
                        <div class="stat-label">ç·ãƒ†ã‚¹ãƒˆæ•°</div>
                    </div>
                    <div class="stat stat-passed">
                        <div class="stat-number" id="passedTests">0</div>
                        <div class="stat-label">æˆåŠŸ</div>
                    </div>
                    <div class="stat stat-failed">
                        <div class="stat-number" id="failedTests">0</div>
                        <div class="stat-label">å¤±æ•—</div>
                    </div>
                    <div class="stat stat-pending">
                        <div class="stat-number" id="pendingTests">0</div>
                        <div class="stat-label">ä¿ç•™</div>
                    </div>
                </div>
            </div>
            
            <div class="test-results" id="testResults">
                <!-- ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
        </div>
    </div>
    
    <!-- ä¾å­˜é–¢ä¿‚ -->
    <script src="../js/main.js"></script>
    <script src="../js/game.js"></script>
    <script src="../js/maze.js"></script>
    <script src="../js/problems.js"></script>
    <script src="../js/ui.js"></script>
    <script src="ui-tests.js"></script>
    
    <script>
        // ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆç®¡ç†
        class TestSuite {
            constructor() {
                this.tests = [];
                this.currentTestIndex = 0;
                this.results = {
                    total: 0,
                    passed: 0,
                    failed: 0,
                    pending: 0
                };
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                document.getElementById('runAllTests').addEventListener('click', () => this.runAllTests());
                document.getElementById('runUnitTests').addEventListener('click', () => this.runTestGroup('unit'));
                document.getElementById('runUITests').addEventListener('click', () => this.runTestGroup('ui'));
                document.getElementById('runGameTests').addEventListener('click', () => this.runTestGroup('game'));
                document.getElementById('clearResults').addEventListener('click', () => this.clearResults());
            }
            
            addTest(name, testFunction, group = 'unit') {
                this.tests.push({
                    name,
                    testFunction,
                    group,
                    status: 'pending',
                    error: null
                });
            }
            
            async runAllTests() {
                this.clearResults();
                await this.runTests(this.tests);
            }
            
            async runTestGroup(group) {
                this.clearResults();
                const groupTests = this.tests.filter(test => test.group === group);
                await this.runTests(groupTests);
            }
            
            async runTests(tests) {
                this.disableButtons();
                this.results = { total: tests.length, passed: 0, failed: 0, pending: tests.length };
                this.updateSummary();
                
                for (let i = 0; i < tests.length; i++) {
                    const test = tests[i];
                    this.updateProgress((i / tests.length) * 100);
                    
                    try {
                        await test.testFunction();
                        test.status = 'passed';
                        this.results.passed++;
                        this.results.pending--;
                    } catch (error) {
                        test.status = 'failed';
                        test.error = error.message;
                        this.results.failed++;
                        this.results.pending--;
                    }
                    
                    this.renderTestResult(test);
                    this.updateSummary();
                    
                    // å°‘ã—å¾…ã£ã¦ã‹ã‚‰æ¬¡ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                this.updateProgress(100);
                this.enableButtons();
            }
            
            renderTestResult(test) {
                const resultsContainer = document.getElementById('testResults');
                let groupContainer = document.querySelector(`[data-group="${test.group}"]`);
                
                if (!groupContainer) {
                    groupContainer = document.createElement('div');
                    groupContainer.className = 'test-group';
                    groupContainer.dataset.group = test.group;
                    
                    const header = document.createElement('div');
                    header.className = 'test-group-header';
                    header.textContent = this.getGroupTitle(test.group);
                    groupContainer.appendChild(header);
                    
                    resultsContainer.appendChild(groupContainer);
                }
                
                const testCase = document.createElement('div');
                testCase.className = `test-case ${test.status}`;
                
                const testName = document.createElement('div');
                testName.className = 'test-name';
                testName.textContent = test.name;
                
                const testStatus = document.createElement('div');
                testStatus.className = `test-status ${test.status}`;
                testStatus.textContent = this.getStatusText(test.status);
                
                testCase.appendChild(testName);
                testCase.appendChild(testStatus);
                
                if (test.error) {
                    const errorDetails = document.createElement('div');
                    errorDetails.className = 'error-details';
                    errorDetails.textContent = test.error;
                    testCase.appendChild(errorDetails);
                }
                
                groupContainer.appendChild(testCase);
            }
            
            getGroupTitle(group) {
                const titles = {
                    unit: 'ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ',
                    ui: 'UIãƒ†ã‚¹ãƒˆ',
                    game: 'ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ'
                };
                return titles[group] || 'ãã®ä»–ã®ãƒ†ã‚¹ãƒˆ';
            }
            
            getStatusText(status) {
                const texts = {
                    passed: 'æˆåŠŸ',
                    failed: 'å¤±æ•—',
                    pending: 'ä¿ç•™'
                };
                return texts[status] || status;
            }
            
            updateProgress(percentage) {
                const progressFill = document.getElementById('progressFill');
                progressFill.style.width = `${percentage}%`;
            }
            
            updateSummary() {
                const summary = document.getElementById('testSummary');
                summary.style.display = 'block';
                
                document.getElementById('totalTests').textContent = this.results.total;
                document.getElementById('passedTests').textContent = this.results.passed;
                document.getElementById('failedTests').textContent = this.results.failed;
                document.getElementById('pendingTests').textContent = this.results.pending;
            }
            
            clearResults() {
                document.getElementById('testResults').innerHTML = '';
                document.getElementById('testSummary').style.display = 'none';
                this.updateProgress(0);
                this.results = { total: 0, passed: 0, failed: 0, pending: 0 };
            }
            
            disableButtons() {
                const buttons = document.querySelectorAll('.test-btn');
                buttons.forEach(btn => btn.disabled = true);
            }
            
            enableButtons() {
                const buttons = document.querySelectorAll('.test-btn');
                buttons.forEach(btn => btn.disabled = false);
            }
        }
        
        // ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’åˆæœŸåŒ–
        const testSuite = new TestSuite();
        
        // ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
        testSuite.addTest('Utils.formatTime() ãƒ†ã‚¹ãƒˆ', () => {
            if (typeof Utils === 'undefined') throw new Error('Utils ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            const formatted = Utils.formatTime(125);
            if (formatted !== '2:05') throw new Error(`æœŸå¾…å€¤: 2:05, å®Ÿéš›: ${formatted}`);
        }, 'unit');
        
        testSuite.addTest('Utils.random() ãƒ†ã‚¹ãƒˆ', () => {
            if (typeof Utils === 'undefined') throw new Error('Utils ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            const result = Utils.random(1, 10);
            if (result < 1 || result > 10) throw new Error(`ç¯„å›²å¤–ã®å€¤: ${result}`);
        }, 'unit');
        
        testSuite.addTest('CONFIG è¨­å®šãƒ†ã‚¹ãƒˆ', () => {
            if (typeof CONFIG === 'undefined') throw new Error('CONFIG ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            if (!CONFIG.LANGUAGE) throw new Error('LANGUAGE ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
            if (!CONFIG.FONT_SIZE) throw new Error('FONT_SIZE ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
        }, 'unit');
        
        // ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
        testSuite.addTest('GameState åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ', () => {
            if (typeof GameState === 'undefined') throw new Error('GameState ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            const game = new GameState();
            if (game.level !== 1) throw new Error('åˆæœŸãƒ¬ãƒ™ãƒ«ãŒ1ã§ã¯ã‚ã‚Šã¾ã›ã‚“');
            if (game.stage !== 1) throw new Error('åˆæœŸã‚¹ãƒ†ãƒ¼ã‚¸ãŒ1ã§ã¯ã‚ã‚Šã¾ã›ã‚“');
            if (game.score !== 0) throw new Error('åˆæœŸã‚¹ã‚³ã‚¢ãŒ0ã§ã¯ã‚ã‚Šã¾ã›ã‚“');
        }, 'game');
        
        testSuite.addTest('ã‚²ãƒ¼ãƒ è¨­å®šãƒ†ã‚¹ãƒˆ', () => {
            if (typeof GAME_CONFIG === 'undefined') throw new Error('GAME_CONFIG ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            if (!GAME_CONFIG.LEVELS || GAME_CONFIG.LEVELS.length === 0) {
                throw new Error('ãƒ¬ãƒ™ãƒ«è¨­å®šãŒå­˜åœ¨ã—ã¾ã›ã‚“');
            }
        }, 'game');
        
        // UIãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
        testSuite.addTest('DOMè¦ç´ å­˜åœ¨ãƒ†ã‚¹ãƒˆ', () => {
            const requiredElements = ['header', 'main', 'footer'];
            for (const id of requiredElements) {
                if (!document.getElementById(id)) {
                    throw new Error(`è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${id}`);
                }
            }
        }, 'ui');
        
        testSuite.addTest('ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¦ç´ ãƒ†ã‚¹ãƒˆ', () => {
            const nav = document.querySelector('nav');
            if (!nav) throw new Error('ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            
            const links = nav.querySelectorAll('a');
            if (links.length === 0) throw new Error('ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }, 'ui');
        
        testSuite.addTest('ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¦ç´ ãƒ†ã‚¹ãƒˆ', () => {
            const mobileMenu = document.querySelector('#mobileMenuButton');
            if (!mobileMenu) throw new Error('ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }, 'ui');
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«è¡¨ç¤º
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
            console.log(`ç™»éŒ²ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆæ•°: ${testSuite.tests.length}`);
        });
    </script>
</body>
</html> 